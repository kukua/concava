<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration - ConCaVa</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Configuration";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> ConCaVa</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Configuration</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#configuration">Configuration</a></li>
                
                    <li><a class="toctree-l4" href="#adapters">Adapters</a></li>
                
                    <li><a class="toctree-l4" href="#connectors">Connectors</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../api/">API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../contributing/">Contributing</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">ConCaVa</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Configuration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="configuration">Configuration</h1>
<p>The ConCaVa repository contains a <a href="https://github.com/kukua/concava/blob/master/config.js.example">config.js.example file</a>, containing all the configuration options.</p>
<h2 id="adapters">Adapters</h2>
<p>ConCaVa allows you to provide your own authentication, metadata (device configuration), and storage. These are down through generic adapters.
Adapters are simply asynchronous JavaScript functions. Each of these adapter functions accepts four or five arguments:</p>
<pre><code class="js">// req = Express request
// config = auth, metadata, or storage object from config.js
// data = SensorData instance
// classes = { SensorData, SensorAttribute }
// cb = callback function

function (req, config, data, cb) {}
function (req, config, data, classes, cb) {}
</code></pre>

<p>The latter is used for providing metadata with the classes used by ConCaVa.</p>
<h3 id="authentication">Authentication</h3>
<p>Example authentication adapter:</p>
<pre><code class="js">function auth (req, config, data, cb) {
    // return cb() // To disable authentication

    console.log(req.auth) // { udid: '...', token: '...' }
    // token will only be added if config.byToken === true

    var user = { id: 1, name: 'User 1' }
    cb(null, user)
    // The value of user is assigned to req.user
}
</code></pre>

<h3 id="metadata">Metadata</h3>
<p>Example metadata adapter:</p>
<pre><code class="js">function metadata (req, config, data, classes, cb) {
    // data is instance of classes.SensorData
    if (data.getDeviceId() !== '0000000000000001') {
        return cb('No metadata for device.')
    }

    var attr1 = new classes.SensorAttribute('attr1')
    attr1.addConverter('uint32be')
    attr1.addValidator('min', 100)
    attr1.addValidator('max', 1300)

    var attr2 = new classes.SensorAttribute('attr2')
    attr2.addConverter('int16le')
    attr2.addCalibrator('return value + 7')

    data.setAttributes([attr1, attr2])
    cb()
}
</code></pre>

<h3 id="storage">Storage</h3>
<p>Example storage adapter:</p>
<pre><code class="js">function storage (req, config, data, cb) {
    var udid = data.getDeviceId()

    console.log(udid, data.getData())
    cb()
}
</code></pre>

<div class="admonition note">
    <p class="first admonition-title">Note</p>
    <p class="last">In debug mode, ConCaVa will also write the data to the log file.</p>
</div>

<h3 id="available">Available</h3>
<p>The following adapters are available:</p>
<ul>
<li><a href="https://github.com/kukua/node-concava-adapter-mysql">MySQL authentication, metadata, and storage</a></li>
<li><a href="https://github.com/kukua/concava-setup-context-broker">Orion Context Broker authentication, metadata, and storage</a></li>
<li><a href="https://github.com/kukua/node-concava-adapter-mqtt">MQTT storage</a></li>
<li><a href="https://github.com/kukua/node-concava-adapter-influxdb">InfluxDB storage</a></li>
</ul>
<p><a href="https://github.com/kukua/?utf8=%E2%9C%93&amp;query=adapter">Search for 'adapter' on Github</a> to see all official adapters.
Contributing other adapters is highly appreciated. See <a href="../contributing/#adapters">the contributing page</a> for more information.</p>
<h2 id="connectors">Connectors</h2>
<p>Connectors are used to support other communication protocols. They act as a proxy for ConCaVa. A connector extracts the UDID and binary payload from protocol packet of your liking. For example: the MQTT connector provides an MQTT broker that uses the <code>clientId</code> and <code>password</code> configuration options for UDID and auth token. Any data it receives will used as binary payload to forward to ConCaVa.</p>
<h3 id="available_1">Available</h3>
<p>The following connectors are available:</p>
<ul>
<li><a href="https://github.com/kukua/concava-connector-lora">LoRa</a>. Handles LoRa XML (from a KPN server webhook for example).</li>
<li><a href="https://github.com/kukua/concava-connector-ttn">LoRa TTN</a>. Handles The Things Network LoRa packets.</li>
<li><a href="https://github.com/kukua/concava-connector-mqtt">MQTT</a>.</li>
<li><a href="https://github.com/kukua/concava-connector-spul">SPUL</a> stands for <em>Sensor Protocol Ultra Light</em>. Documentation can be <a href="http://kukua.github.io/concava-connector-spul/">found here</a>.</li>
</ul>
<p><a href="https://hub.docker.com/search/?isAutomated=0&amp;isOfficial=0&amp;page=1&amp;pullCount=0&amp;q=concava&amp;starCount=0">Search for 'ConCaVa' on the Docker Hub</a> to see all connectors.
Contributing other connectors is highly appreciated. See <a href="../contributing/#connectors">the contributing page</a> for more information.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/" class="btn btn-neutral float-right" title="API"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
